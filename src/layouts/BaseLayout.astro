---
import { site } from "../siteData";

const { title, description, ogImage, ogType } = Astro.props;
const pathname = Astro.url.pathname;
const pageTitle = title ? `${title} | ${site.title}` : site.title;
const pageDescription = description ?? site.description;
const ogImageUrl = ogImage ? new URL(ogImage, site.url).toString() : undefined;
const ogContentType = ogType ?? "website";

const isActive = (href) => {
  if (href === "/") return pathname === "/";
  return pathname.startsWith(href);
};
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    <meta name="color-scheme" content="light dark" />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:type" content={ogContentType} />
    <meta property="og:url" content={site.url + pathname} />
    {ogImageUrl && <meta property="og:image" content={ogImageUrl} />}
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png" />
    <link rel="manifest" href="/assets/images/site.webmanifest" />
    <link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="/assets/styles.css" />

    <style>
      .blog-header {
        line-height: 1;
        border-bottom: 1px solid #e5e5e5;
      }

      .blog-header-logo {
        font-size: 2.25rem;
      }

      .blog-header-logo:hover {
        text-decoration: none;
      }

      h1, h2, h3, h4, h5, h6 {
        font-family: "Playfair Display", Georgia, "Times New Roman", serif;
      }

      .display-4 {
        font-size: 2.5rem;
      }
      @media (min-width: 768px) {
        .display-4 {
          font-size: 3rem;
        }
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .nav-scroller .nav-link {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
        font-size: 0.875rem;
      }

      .h-250 { height: 250px; }
      @media (min-width: 768px) {
        .h-md-250 { height: 250px; }
      }

      .blog-title {
        margin-bottom: 0;
        font-size: 2rem;
        font-weight: 400;
      }
      .blog-description {
        font-size: 1.1rem;
        color: #999;
      }

      @media (min-width: 40em) {
        .blog-title {
          font-size: 3.5rem;
        }
      }

      .blog-pagination {
        margin-bottom: 4rem;
      }
      .blog-pagination > .btn {
        border-radius: 2rem;
      }

      .blog-post {
        margin-bottom: 4rem;
      }
      .blog-post-title {
        margin-bottom: 0.25rem;
        font-size: 2.5rem;
      }
      .blog-post-meta {
        margin-bottom: 1.25rem;
        color: #999;
      }

      .blog-footer {
        padding: 2.5rem 0;
        color: #999;
        text-align: center;
        background-color: #f9f9f9;
        border-top: 0.05rem solid #e5e5e5;
      }
      .blog-footer p:last-child {
        margin-bottom: 0;
      }
    </style>
  </head>
  <body>
    <span id="top-of-page"></span>
    <div class="container">
      <header class="blog-header py-3">
        <div class="row flex-nowrap justify-content-between align-items-center">
          <div class="col-4 pt-1"></div>
          <div class="col-4 text-center">
            <a
              class:list={["blog-header-logo", "text-dark", (pathname === "/" || pathname === "/index.html") && "active"]}
              href="/"
            >
              {site.title}
            </a>
          </div>
          <div class="col-4 d-flex justify-content-end align-items-center"></div>
        </div>
      </header>

      <div class="nav-scroller py-1 mb-2">
        <nav class="nav d-flex justify-content-between bg-light">
          <a class:list={["p-2", isActive("/") ? "text-muted" : "text-dark"]} href="/">Home</a>
          <a class:list={["p-2", isActive("/blog/") ? "text-muted" : "text-dark"]} href="/blog/">Posts</a>
          <a class:list={["p-2", isActive("/projects/") ? "text-muted" : "text-dark"]} href="/projects/">Projects</a>
          <a class:list={["p-2", isActive("/resume/") ? "text-muted" : "text-dark"]} href="/resume/">Resum√©</a>
          <a class:list={["p-2", isActive("/about/") ? "text-muted" : "text-dark"]} href="/about/">About Me</a>
        </nav>
      </div>

      <main>
        <slot />
      </main>

      <footer class="blog-footer"></footer>
    </div>

    {site.gaId && (
      <div id="cookie-notice">
        <span>We would like to use Google Analytics to monitor website utilization.</span>
        <a href="#" id="cookie-notice-accept" class="btn btn-primary btn-sm">Approve</a>
        <a href="#" id="cookie-notice-deny" class="btn btn-primary btn-sm">Deny</a>
      </div>
    )}

    {site.gaId && (
      <script is:inline>
        const cookieName = "cookie-notice-option";

        function createCookie(name, value, days) {
          let expires = "";
          if (days) {
            const date = new Date();
            date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
            expires = "; expires=" + date.toUTCString();
          }
          document.cookie = name + "=" + value + expires + "; path=/";
        }

        function readCookie(name) {
          const nameEQ = name + "=";
          const ca = document.cookie.split(";");
          for (let i = 0; i < ca.length; i += 1) {
            let c = ca[i];
            while (c.charAt(0) === " ") c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
          }
          return null;
        }

        function loadAnalytics() {
          const script = document.createElement("script");
          script.async = true;
          script.src = "https://www.googletagmanager.com/gtag/js?id=" + "${site.gaId}";
          document.head.appendChild(script);

          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag("js", new Date());
          gtag("config", "${site.gaId}", { anonymize_ip: true });
        }

        const notice = document.getElementById("cookie-notice");
        const option = readCookie(cookieName);

        if (option === "true") {
          loadAnalytics();
        } else if (option !== "false" && notice) {
          notice.style.display = "block";
        }

        const accept = document.getElementById("cookie-notice-accept");
        const deny = document.getElementById("cookie-notice-deny");

        if (accept) {
          accept.addEventListener("click", (event) => {
            event.preventDefault();
            createCookie(cookieName, "true", 31);
            if (notice) notice.style.display = "none";
            loadAnalytics();
          });
        }

        if (deny) {
          deny.addEventListener("click", (event) => {
            event.preventDefault();
            createCookie(cookieName, "false", 31);
            if (notice) notice.style.display = "none";
          });
        }
      </script>
    )}
  </body>
</html>
