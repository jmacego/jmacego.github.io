---
import BaseLayout from "../../layouts/BaseLayout.astro";
import {
  getExcerpt,
  isPublished,
  sortByDateDesc,
  stripDatePrefix,
  PAGE_SIZE,
} from "../../utils/content";
import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }) {
  const posts = (await getCollection("posts", isPublished)).sort(sortByDateDesc);
  return paginate(posts, { pageSize: PAGE_SIZE });
}

const { page } = Astro.props;
---

<BaseLayout title="John MacDonald's Posts" description="John MacDonald's Posts">
  <div class="row">
    {page.data.map((post) => {
      const slug = stripDatePrefix(post.slug);
      const excerpt = getExcerpt(post.body);
      return (
        <div class="blog-post">
          <h2 class="blog-post-title">{post.data.title}</h2>
          {post.data.categories?.length ? (
            <p class="blog-post-meta">
              Categories: {post.data.categories.join(", ")}
            </p>
          ) : null}
          <p set:html={excerpt} />
          <p class="lead">
            Continue reading <a href={`/blog/${slug}/`}>{post.data.title}</a>
          </p>
        </div>
      );
    })}
  </div>

  <nav class="blog-pagination">
    {page.url.prev && (
      <a class="btn btn-outline-primary" href={page.url.prev}>
        Newer
      </a>
    )}
    {page.url.next && (
      <a class="btn btn-outline-primary" href={page.url.next}>
        Older
      </a>
    )}
  </nav>
</BaseLayout>
