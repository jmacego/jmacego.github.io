---
import BaseLayout from "../../layouts/BaseLayout.astro";
import {
  getEntryDate,
  getExcerpt,
  isPublished,
  sortByDateDesc,
  stripDatePrefix,
  formatDate,
} from "../../utils/content";
import { getCollection } from "astro:content";

const projects = (await getCollection("projects", isPublished)).sort(sortByDateDesc);
---

<BaseLayout title="John MacDonald's Projects" description="John MacDonald's Projects">
  <div class="row">
    {projects.map((project) => {
      const slug = stripDatePrefix(project.slug);
      const excerpt = getExcerpt(project.body);
      const date = getEntryDate(project);
      return (
        <div class="blog-post">
          <h2 class="blog-post-title">{project.data.title}</h2>
          {project.data.categories?.length ? (
            <p class="blog-post-meta">
              Categories: {project.data.categories.join(", ")}
            </p>
          ) : null}
          {date && <p class="blog-post-meta">{formatDate(date)}</p>}
          <p set:html={excerpt} />
          <p class="lead">
            Continue reading about <a href={`/projects/${slug}/`}>{project.data.title}</a>
          </p>
        </div>
      );
    })}
  </div>
</BaseLayout>
