---
import BaseLayout from "../../layouts/BaseLayout.astro";
import {
  formatDate,
  getExcerpt,
  isPublished,
  normalizeImagePath,
  sortByDateDesc,
  stripDatePrefix,
} from "../../utils/content";
import { getCollection } from "astro:content";

const projects = (await getCollection("projects", isPublished)).sort(sortByDateDesc);
---

<BaseLayout title="Projects" description="Hands-on work across infrastructure, networking, and automation.">
  <h1 class="section-title">Projects</h1>
  <div class="post-list">
    {projects.map((project) => {
      const slug = stripDatePrefix(project.slug);
      const excerpt = getExcerpt(project.body);
      const imagePath = normalizeImagePath(project.data.image?.path);
      return (
        <article class="post-list-item">
          {imagePath && (
            <div class="card-media">
              <img src={imagePath} alt={project.data.image?.alt ?? project.data.title} loading="lazy" />
            </div>
          )}
          <h2>
            <a href={`/projects/${slug}/`}>{project.data.title}</a>
          </h2>
          {project.data.date && <p class="post-meta">{formatDate(project.data.date)}</p>}
          {excerpt && <div class="post-excerpt" set:html={excerpt} />}
          <a class="text-link" href={`/projects/${slug}/`}>
            Explore project
          </a>
        </article>
      );
    })}
  </div>
</BaseLayout>
